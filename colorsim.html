<!DOCTYPE html>
<html>
  <head>
    <title>PebbleColorSimulator</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css" />
    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
    <script src="spectrum.js"></script>
    <link rel="stylesheet" href="spectrum.css" />
  </head>
  <body>
    <div data-role="page" id="main">
      <div data-role="header" class="jqm-header">
        <h1>PebbleColorSimulator</h1>
      </div>
      <div data-role="content">
      
<!--背景色-->
<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
    <legend>BackColor1:</legend>
    <input type="text" name="nmColor" id="txtBack1"/>
	<div></div>
</fieldset>
<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
    <legend>ForeColor1:</legend>
    <input type="text" name="nmColor" id="txtFore1"/>
    <div></div>
</fieldset>
<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
    <legend>BackColor2:</legend>
    <input type="text" name="nmColor" id="txtBack2"/>
    <div></div>
</fieldset>
<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
    <legend>ForeColor2:</legend>
    <input type="text" name="nmColor" id="txtFore2"/>
    <div></div>
</fieldset>
<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
    <legend>BorderColor:</legend>
    <input type="text" name="nmColor" id="txtBorder"/>
    <div></div>
</fieldset>

<fieldset data-role="controlgroup" data-type="horizontal">
	<button type="submit" data-theme="b" id="btnDefault">Load Default</button>
</fieldset>

    </div>

<br />
	<div class="ui-body ui-body-c">
		<fieldset class="ui-grid-a">
			<div class="ui-block-a">
				<button type="submit" data-theme="d" id="btnCancel">Cancel</button>
			</div>
			<div class="ui-block-b">
				<button type="submit" data-theme="b" id="btnSubmit">Submit</button>
			</div>
		</fieldset>
	</div>
</div>
    <script>
    		function utf8_to_b64(str) 
    		{
    			return window.btoa(unescape(encodeURIComponent(str)));
      		}
      		
		function saveOptions()
		{
			var options =
			{
				"BackColor1":$("#txtBack1").spectrum("get").toHex(),
				"ForeColor1":$("#txtFore1").spectrum("get").toHex(),
				"BackColor2":$("#txtBack2").spectrum("get").toHex(),
				"ForeColor2":$("#txtFore2").spectrum("get").toHex(),
				"BorderColor":$("#txtBorder").spectrum("get").toHex()
			}
			return options;
		}
		
		$().ready(function()
		{
		
			var vpalette = [];
  			
			//色情報読み込み
			var colors;
            $.ajax({
			    url: "pebblecolors.json",
			    dataType: 'json',
			    async: false,
			    success: function(json) {
			        colors = json;
	                for(var i in json)
	                {
	                	vpalette.push(json[i].value);
	                }
			    }
			});
			
			$("input[name=nmColor]").spectrum({
			    showPaletteOnly: true,
			    showPalette:true,
			    hideAfterPaletteSelect:true,
			    palette: vpalette
			});
			
			//色初期設定
		    $("#txtBack1").spectrum("set", "#AAFFFF");	//Celeste
			$("#txtFore1").spectrum("set", "#0055FF");	//Blue Moon
			$("#txtBack2").spectrum("set", "#AAFFAA");	//Mint Green
			$("#txtFore2").spectrum("set", "#AA55FF");	//Lavender Indigo
			$("#txtBorder").spectrum("set", "#AA5500");	//Windsor Tan
				
			//localStorageにあれば読み込み
			if (typeof window.localStorage !== "undefined") {
				if (window.localStorage.pebble_PebbleColorSimulator_options) 
				{
					ls_pto = JSON.parse(window.localStorage.pebble_PebbleColorSimulator_options);
					
	  				$("#txtBack1").spectrum("set", "#" + ls_pto["BackColor1"]);
	  				$("#txtFore1").spectrum("set", "#" + ls_pto["ForeColor1"]);
	  				$("#txtBack2").spectrum("set", "#" + ls_pto["BackColor2"]);
	  				$("#txtFore2").spectrum("set", "#" + ls_pto["ForeColor2"]);
	  				$("#txtBorder").spectrum("set", "#" + ls_pto["BorderColor"]);
		  		}
		  	}
			
			$("#btnDefault").click(function()
			{
				//色初期設定
			    $("#txtBack1").spectrum("set", "#AAFFFF");	//Celeste
				$("#txtFore1").spectrum("set", "#0055FF");	//Blue Moon
				$("#txtBack2").spectrum("set", "#AAFFAA");	//Mint Green
				$("#txtFore2").spectrum("set", "#AA55FF");	//Lavender Indigo
				$("#txtBorder").spectrum("set", "#AA5500");	//Windsor Tan
			});
			$("#btnCancel").click(function()
			{
				location.href = getQueryParam("return_to", "pebblejs://close#");
			});
			$("#btnSubmit").click(function()
			{
				ls_pto = JSON.stringify(saveOptions());
				//localStorageに保存
          			if (typeof window.localStorage !== "undefined") 
          			{
					window.localStorage.pebble_PebbleColorSimulator_options = ls_pto;
				}
				
				var return_to = getQueryParam("return_to", "pebblejs://close#");
				
				location.href = return_to + utf8_to_b64(ls_pto);
			});
		});
		function getQueryVariable(variable)
		{
			var query = location.search.substring(1);
			var vars = query.split('&');
			for(var i = 0; i < vars.length; i++)
			{
				var pair = vars[i].split('=');
				if(pair[0] == variable)
				{
					return decodeURIComponent(pair[1]);
				}
			}
			return false;
		}
		// Something like this to get query variables.
		function getQueryParam(variable, default_) {
		    var query = location.search.substring(1);
		    var vars = query.split('&');
		    for (var i = 0; i < vars.length; i++) {
		        var pair = vars[i].split('=');
		        if (pair[0] == variable)
		            return decodeURIComponent(pair[1]);
		    }
		    return default_ || false;
		}
    </script>
  </body>
</html>

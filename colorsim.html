<!DOCTYPE html>
<html>
  <head>
    <title>PebbleColorSimulator</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css" />
    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
  </head>
  <body>
    <div data-role="page" id="main">
      <div data-role="header" class="jqm-header">
        <h1>PebbleColorSimulator</h1>
      </div>
      <div data-role="content">
      
<!--背景色-->
<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
    <legend>BackColor1:</legend>
    <select name="ColorPicker" id="ddlBack1" ></select>
</fieldset>
<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
    <legend>ForeColor1:</legend>
    <select name="ColorPicker" id="ddlFore1" ></select>
</fieldset>
<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
    <legend>BackColor2:</legend>
    <select name="ColorPicker" id="ddlBack2" ></select>
</fieldset>
<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
    <legend>ForeColor2:</legend>
    <select name="ColorPicker" id="ddlFore2" ></select>
</fieldset>
<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
    <legend>BorderColor:</legend>
    <select name="ColorPicker" id="ddlBorder" ></select>
</fieldset>

<fieldset data-role="controlgroup" data-type="horizontal">
	<button type="submit" data-theme="b" id="btnDefault">Load Default</button>
</fieldset>

    </div>

<br />
	<div class="ui-body ui-body-c">
		<fieldset class="ui-grid-a">
			<div class="ui-block-a">
				<button type="submit" data-theme="d" id="btnCancel">Cancel</button>
			</div>
			<div class="ui-block-b">
				<button type="submit" data-theme="b" id="btnSubmit">Submit</button>
			</div>
		</fieldset>
	</div>
</div>
    <script>
    		function utf8_to_b64(str) 
    		{
    			return window.btoa(unescape(encodeURIComponent(str)));
      		}
      		
		function saveOptions()
		{
			
			var df = $("#ddlDate1").val() +
					 $("#ddlDate2").val() +
					 $("#ddlDate3").val() +
					 $("#ddlDate4").val() +
					 $("#ddlDate5").val();
			var options =
			{
				"BackColor1":$("#ddlBack1").val(),
				"ForeColor1":$("#ddlFore1").val(),
				"BackColor2":$("#ddlBack2").val(),
				"ForeColor2":$("#ddlFore2").val(),
				"BorderColor":$("#ddlBorder").val()
			}
			return options;
		}
		
		$().ready(function()
		{
			//色情報読み込み
			var colors;
            $.ajax({
			    url: "pebblecolors.json",
			    dataType: 'json',
			    async: false,
			    success: function(json) {
			        colors = json;
			        $('select[name="ColorPicker"]').children().remove();
	                for(var i in json)
	                {
	                    $('select[name="ColorPicker"]').append("<option value='" + json[i].value.replace(/#/g,"") + "' style='background-color: " + json[i].value + ";color: " + json[i].color + "'>" + json[i].name + "</option>");
	                }
	                //色初期設定
		        $("#ddlBack1").val("AAFFFF");	//Celeste
			$("#ddlFore1").val("0055FF");	//Blue Moon
			$("#ddlBack2").val("AAFFAA");	//Mint Green
			$("#ddlFore2").val("AA55FF");	//Lavender Indigo
			$("#ddlBorder").val("AA5500");	//Windsor Tan
			    }
			});

            //選択した色で背景色変更
            $('select[name="ColorPicker"]').bind('change', function()
            {
		        $(this).parent("div").css("background",  colors[$(this).prop("selectedIndex")].value);
		        $(this).parent("div").css("color",  colors[$(this).prop("selectedIndex")].color);
		    });
		    
			//localStorageにあれば読み込み
			if (typeof window.localStorage !== "undefined") {
				if (window.localStorage.pebble_PebbleColorSimulator_options) 
				{
					ls_pto = JSON.parse(window.localStorage.pebble_PebbleColorSimulator_options);
					
	  				$("#ddlBack1").val(ls_pto["BackColor1"]);
	  				$("#ddlFore1").val(ls_pto["ForeColor1"]);
	  				$("#ddlBack2").val(ls_pto["BackColor2"]);
	  				$("#ddlFore2").val(ls_pto["ForeColor2"]);
	  				$("#ddlBorder").val(ls_pto["BorderColor"]);
		  		}
		  	}
		  	//色情報更新
	   		$("#ddlBack1").selectmenu('refresh');
			$("#ddlFore1").selectmenu('refresh');
			$("#ddlBack2").selectmenu('refresh');
			$("#ddlFore2").selectmenu('refresh');
			$("#ddlBorder").selectmenu('refresh');
			
			$("#ddlBack1").change();
			$("#ddlFore1").change();
			$("#ddlBack2").change();
			$("#ddlFore2").change();
			$("#ddlBorder").change();
			
			$("#btnDefault").click(function()
			{
				//色初期設定
			        $("#ddlBack1").val("AAFFFF");	//Celeste
				$("#ddlFore1").val("0055FF");	//Blue Moon
				$("#ddlBack2").val("AAFFAA");	//Mint Green
				$("#ddlFore2").val("AA55FF");	//Lavender Indigo
				$("#ddlBorder").val("AA5500");	//Windsor Tan
				
				//色情報更新
		   		$("#ddlBack1").selectmenu('refresh');
				$("#ddlFore1").selectmenu('refresh');
				$("#ddlBack2").selectmenu('refresh');
				$("#ddlFore2").selectmenu('refresh');
				$("#ddlBorder").selectmenu('refresh');
				
				$("#ddlBack1").change();
				$("#ddlFore1").change();
				$("#ddlBack2").change();
				$("#ddlFore2").change();
				$("#ddlBorder").change();
			});
			$("#btnCancel").click(function()
			{
				location.href = getQueryParam("return_to", "pebblejs://close#");
			});
			$("#btnSubmit").click(function()
			{
				ls_pto = JSON.stringify(saveOptions());
				//localStorageに保存
          			if (typeof window.localStorage !== "undefined") 
          			{
					window.localStorage.pebble_PebbleColorSimulator_options = ls_pto;
				}
				
				var return_to = getQueryParam("return_to", "pebblejs://close#");
				
				location.href = return_to + utf8_to_b64(ls_pto);
			});
		});
		function getQueryVariable(variable)
		{
			var query = location.search.substring(1);
			var vars = query.split('&');
			for(var i = 0; i < vars.length; i++)
			{
				var pair = vars[i].split('=');
				if(pair[0] == variable)
				{
					return decodeURIComponent(pair[1]);
				}
			}
			return false;
		}
		// Something like this to get query variables.
		function getQueryParam(variable, default_) {
		    var query = location.search.substring(1);
		    var vars = query.split('&');
		    for (var i = 0; i < vars.length; i++) {
		        var pair = vars[i].split('=');
		        if (pair[0] == variable)
		            return decodeURIComponent(pair[1]);
		    }
		    return default_ || false;
		}
    </script>
  </body>
</html>

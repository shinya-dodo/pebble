<!DOCTYPE html>
<html>
  <head>
    <title>Configuration</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
  </head>
  <body>
    <div data-role="page" id="main">
      <div data-role="header" class="jqm-header">
        <h1>Configuration</h1>
      </div>

      <div data-role="content">

<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
    <legend>BackGround Color:</legend>
        <label for="black">Black</label>
		<input type="radio" id="black" name="bgcolor" value="1" data-theme="c"/>
		
		<label for="white">White</label>
		<input type="radio" id="white" name="bgcolor" value="2" data-theme="c"/>
		
		<label for="color">Color</label>
		<input type="radio" id="color" name="bgcolor" value="3" data-theme="c" checked="checked"/>
</fieldset>

<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true">
    <legend>Start of Week:</legend>
        <input name="week" id="sunday" value="0" checked="checked" type="radio">
        <label for="sunday">Sun</label>
        <input name="week" id="monday" value="1" type="radio">
        <label for="monday">Mon</label>
</fieldset>

<fieldset id="DateFormat" data-role="controlgroup" data-type="horizontal" data-mini="true">
    <legend>Date Format:</legend>
    <select name="ddlDate1" id="ddlDate1">
		<option value="Y" selected>YYYY</option>
		<option value="m">MM</option>
		<option value="d">DD</option>
		<option value="G">GGYY</option>
		<option value=""></option>
	</select>
	<select name="ddlDate2" id="ddlDate2">
		<option value="/" selected>/</option>
		<option value="-">-</option>
		<option value=".">.</option>
		<option value=""></option>
	</select>
	<select name="ddlDate3" id="ddlDate3">
		<option value="Y">YYYY</option>
		<option value="m" selected>MM</option>
		<option value="d">DD</option>
	</select>
	<select name="ddlDate4" id="ddlDate4">
		<option value="/" selected>/</option>
		<option value="-">-</option>
		<option value=".">.</option>
		<option value=""></option>
	</select>
	<select name="ddlDate5" id="ddlDate5">
		<option value="Y">YYYY</option>
		<option value="m">MM</option>
		<option value="d" selected>DD</option>
		<option value=""></option>
	</select>
</fieldset>

    </div>

<br />
	<div class="ui-body ui-body-c">
		<fieldset class="ui-grid-a">
			<div class="ui-block-a">
				<button type="submit" data-theme="d" id="btnCancel">Cancel</button>
			</div>
			<div class="ui-block-b">
				<button type="submit" data-theme="b" id="btnSubmit">Submit</button>
			</div>
		</fieldset>
	</div>
</div>
    <script>
		function saveOptions()
		{
			var df = $("#ddlDate1").val() +
					 $("#ddlDate2").val() +
					 $("#ddlDate3").val() +
					 $("#ddlDate4").val() +
					 $("#ddlDate5").val();
			var options =
			{
				"bgcolor": parseInt($("input:radio[name=bgcolor]:checked").val()),
				"week": parseInt($("input:radio[name=week]:checked").val()),
				"dateformat": df
			}
			return options;
		}
		
		$().ready(function()
		{
			//localStorageにあれば読み込み
			if (typeof window.localStorage !== "undefined") {
				if (window.localStorage.pebble_DateTimeCalendar2_options) 
				{
					ls_pto = JSON.parse(window.localStorage.pebble_DateTimeCalendar2_options);
					
		  			$("input[name=bgcolor][value=" +ls_pto["bgcolor"] + "]").prop('checked',true);
		  			$("input[name=bgcolor]").checkboxradio('refresh');	
		  			
		  			$("input[name=week][value=" +ls_pto["week"] + "]").prop('checked',true);
		  			$("input[name=week]").checkboxradio('refresh');	
		  			
		  			if('dateformat' in ls_pto)
		  			{
		  				$("#ddlDate1").val(ls_pto["dateformat"].substr(0, 1));
		  				$("#ddlDate2").val(ls_pto["dateformat"].substr(1, 1));
		  				$("#ddlDate3").val(ls_pto["dateformat"].substr(2, 1));
		  				$("#ddlDate4").val(ls_pto["dateformat"].substr(3, 1));
		  				$("#ddlDate5").val(ls_pto["dateformat"].substr(4, 1));
		  				$("#ddlDate1").selectmenu('refresh');
		  				$("#ddlDate2").selectmenu('refresh');
		  				$("#ddlDate3").selectmenu('refresh');
		  				$("#ddlDate4").selectmenu('refresh');
		  				$("#ddlDate5").selectmenu('refresh');
		  			}
		  		}
		  	}
		  	
			$("#btnCancel").click(function()
			{
				location.href = getQueryParam("return_to", "pebblejs://close#");
			});
			$("#btnSubmit").click(function()
			{
				ls_pto = JSON.stringify(saveOptions());
				//localStorageに保存
	          		if (typeof window.localStorage !== "undefined") 
	          		{
					window.localStorage.pebble_DateTimeCalendar2_options = ls_pto;
				}
				
				var return_to = getQueryParam("return_to", "pebblejs://close#");

				location.href = return_to + ls_pto;
			});
			if(getQueryVariable("color") == "0")
			{
				$("#color").parent().hide();
			}
		});
		function getQueryVariable(variable)
		{
			var query = location.search.substring(1);
			var vars = query.split('&');
			for(var i = 0; i < vars.length; i++)
			{
				var pair = vars[i].split('=');
				if(pair[0] == variable)
				{
					return decodeURIComponent(pair[1]);
				}
			}
			return false;
		}
		// Something like this to get query variables.
		function getQueryParam(variable, default_) {
		    var query = location.search.substring(1);
		    var vars = query.split('&');
		    for (var i = 0; i < vars.length; i++) {
		        var pair = vars[i].split('=');
		        if (pair[0] == variable)
		            return decodeURIComponent(pair[1]);
		    }
		    return default_ || false;
		}
    </script>
  </body>
</html>
